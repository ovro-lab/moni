<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ó‡ßã‡¶™‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™</title>

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script>
        // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ index.html ‡¶è‡¶≤‡ßá game.html ‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßá
        if (!sessionStorage.getItem("visitedGame")) {
            sessionStorage.setItem("visitedGame", "true");
            window.location.href = "game.html";
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4b5563;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid #d1d5db;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .btn {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-weight: 700;
            color: #ffffff;
            transition: background-color 0.2s, transform 0.2s;
            cursor: pointer;
            border: none;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background-color: #6366f1;
        }

        .btn-primary:hover {
            background-color: #4f46e5;
        }

        .btn-secondary {
            background-color: #f3f4f6;
            color: #4b5563;
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        .alert-message {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            font-weight: 600;
            text-align: center;
            display: none;
        }

        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
        }

        .alert-error {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .message-item {
            border-bottom: 1px solid #e5e7eb;
            padding: 0.75rem 0;
        }

        .message-item:last-child {
            border-bottom: none;
        }
    </style>
</head>




<body>

    < <!-- Main app container -->
        <div id="app-container" class="container">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">‡¶®‡¶ø‡¶ö‡ßá ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶ì</h1>
            <h2>
                <p>‡¶Æ‡¶®‡¶ø ‡¶è‡¶á ‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶≤‡¶ø‡¶ñü•∞
                </p>
                <P>‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡¶æ (name:moni)<br>‡¶¶‡¶ø‡¶¨‡¶æ ‡¶Ü‡¶∞
                    (password:mehedi) ‡¶¶‡¶ø‡¶¨‡¶æ
                </P>
                <p>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶π‡¶≤‡ßá (name:mehedi)<br> (password:moni) ‡¶¶‡¶ø‡¶¨‡¶æ ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡¶æ</p>

                <pre>(note:tumi sms pathale ami uporer likha kete dibo)
                
            </pre>
                <hr>
                <p>miss you dearüò•</p>
                <hr>
            </h2>
            <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-8">
                <button id="show-send-btn" class="btn btn-primary">‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                <button id="show-view-btn" class="btn btn-secondary">‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
            </div>

            <div id="loading-message" class="alert-message alert-success" style="display: block;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
            </div>

            <div id="app-content" class="hidden">
                <div id="send-message-form">
                    <div class="form-group">
                        <label for="sender-name" class="form-label">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                        <input type="text" id="sender-name" class="form-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required>
                    </div>
                    <div class="form-group">
                        <label for="sender-password" class="form-label">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                        <input type="password" id="sender-password" class="form-input" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="message-content" class="form-label">‡¶ó‡ßã‡¶™‡¶® ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</label>
                        <textarea id="message-content" class="form-input" rows="4" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡ßã‡¶™‡¶® ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                            required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ü‡¶ø ‡¶ï‡¶ñ‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá?</label>
                        <div class="flex items-center space-x-4">
                            <input type="radio" id="mode-one-time" name="message-mode" value="one-time" class="mr-2"
                                checked>
                            <label for="mode-one-time" class="text-gray-700">‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶≤‡ßá‡¶á ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</label>
                        </div>
                        <div class="flex items-center space-x-4 mt-2">
                            <input type="radio" id="mode-timed" name="message-mode" value="timed" class="mr-2">
                            <label for="mode-timed" class="text-gray-700">‡¶¶‡ßá‡¶ñ‡¶æ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶è‡¶ï ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶™‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</label>
                        </div>
                    </div>
                    <button id="send-btn" class="btn btn-primary">‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                    <div id="send-status-message" class="alert-message"></div>
                </div>

                <div id="view-message-form" class="hidden">
                    <div class="form-group">
                        <label for="viewer-name" class="form-label">‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                        <input type="text" id="viewer-name" class="form-input" placeholder="‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="viewer-password" class="form-label">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                        <input type="password" id="viewer-password" class="form-input" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                            required>
                    </div>
                    <button id="view-btn" class="btn btn-primary">‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                    <div id="view-status-message" class="alert-message"></div>
                    <div id="message-display" class="alert-message alert-success">
                        <p class="font-bold">‡¶ó‡ßã‡¶™‡¶® ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú:</p>
                        <div id="viewed-messages-container" class="mt-2"></div>
                    </div>
                </div>
                <p id="user-id-display" class="text-xs text-gray-500 mt-4 text-center"></p>
            </div>
        </div>

        <!-- Firebase SDKs are loaded here -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
            import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
            import { getFirestore, collection, addDoc, query, where, getDocs, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

            // Canvas environment provides these variables automatically
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            const firebaseConfig = {
                apiKey: "AIzaSyAiyMs9HolmJgcGkMyRYQDPayNhsZk1LCQ",
                authDomain: "hiddenlove-007.firebaseapp.com",
                projectId: "hiddenlove-007",
                storageBucket: "hiddenlove-007.firebasestorage.app",
                messagingSenderId: "84815500007",
                appId: "1:84815500007:web:c6b33966ec48ebdbf94842",
                measurementId: "G-51SVRFHRND"
            };

            let app, auth, db, userId;

            // HTML elements
            const showSendBtn = document.getElementById('show-send-btn');
            const showViewBtn = document.getElementById('show-view-btn');
            const sendMessageForm = document.getElementById('send-message-form');
            const viewMessageForm = document.getElementById('view-message-form');
            const sendBtn = document.getElementById('send-btn');
            const viewBtn = document.getElementById('view-btn');
            const senderNameInput = document.getElementById('sender-name');
            const senderPasswordInput = document.getElementById('sender-password');
            const messageContentInput = document.getElementById('message-content');
            const sendStatusMessage = document.getElementById('send-status-message');
            const viewerNameInput = document.getElementById('viewer-name');
            const viewerPasswordInput = document.getElementById('viewer-password');
            const viewStatusMessage = document.getElementById('view-status-message');
            const messageDisplay = document.getElementById('message-display');
            const viewedMessagesContainer = document.getElementById('viewed-messages-container');
            const userIdDisplay = document.getElementById('user-id-display');
            const loadingMessage = document.getElementById('loading-message');
            const appContent = document.getElementById('app-content');

            // Functions to show/hide status messages
            function showStatusMessage(element, message, isError) {
                element.textContent = message;
                element.className = 'alert-message';
                element.style.display = 'block';
                if (isError) {
                    element.classList.add('alert-error');
                } else {
                    element.classList.add('alert-success');
                }
            }

            // Firebase initialization and authentication listener
            async function setupFirebase() {
                try {
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);

                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            userId = user.uid;
                            userIdDisplay.textContent = `‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: ${userId}`;
                            console.log(`Firebase connected. User ID: ${userId}`);
                            loadingMessage.style.display = 'none';
                            appContent.classList.remove('hidden');
                            addEventListeners();
                        } else {
                            await signInAnonymously(auth);
                        }
                    });
                } catch (error) {
                    console.error("Firebase initialization or authentication failed:", error);
                    loadingMessage.style.display = 'none';
                    const errorMessage = "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá Firebase Security Rules ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                    showStatusMessage(loadingMessage, errorMessage, true);
                }
            }
            setupFirebase();

            // This function adds all the event listeners after the app is authenticated
            function addEventListeners() {
                showSendBtn.addEventListener('click', () => {
                    showForm('send-message-form');
                });

                showViewBtn.addEventListener('click', () => {
                    showForm('view-message-form');
                });

                // Message sending logic
                sendBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    showStatusMessage(sendStatusMessage, "‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...", false);
                    sendBtn.disabled = true;

                    const senderName = senderNameInput.value.trim();
                    const password = senderPasswordInput.value.trim();
                    const messageContent = messageContentInput.value.trim();
                    const messageMode = document.querySelector('input[name="message-mode"]:checked').value;

                    if (!senderName || !password || !messageContent) {
                        showStatusMessage(sendStatusMessage, "‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", true);
                        sendBtn.disabled = false;
                        return;
                    }

                    try {
                        const messagesCollectionRef = collection(db, `artifacts/${appId}/public/data/messages`);
                        await addDoc(messagesCollectionRef, {
                            senderName: senderName,
                            password: password,
                            message: messageContent,
                            mode: messageMode,
                            deletionTimestamp: null
                        });

                        showStatusMessage(sendStatusMessage, "‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!", false);
                        senderNameInput.value = '';
                        senderPasswordInput.value = '';
                        messageContentInput.value = '';
                    } catch (error) {
                        console.error("Error sending message:", error);
                        showStatusMessage(sendStatusMessage, `‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${error.message}`, true);
                    } finally {
                        sendBtn.disabled = false;
                    }
                });

                // Message viewing logic with the new one-hour timer
                viewBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    showStatusMessage(viewStatusMessage, "‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...", false);
                    viewBtn.disabled = true;

                    const viewerName = viewerNameInput.value.trim();
                    const viewerPassword = viewerPasswordInput.value.trim();

                    if (!viewerName || !viewerPassword) {
                        showStatusMessage(viewStatusMessage, "‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®‡•§", true);
                        viewBtn.disabled = false;
                        return;
                    }

                    viewedMessagesContainer.innerHTML = '';
                    messageDisplay.style.display = 'none';

                    try {
                        const messagesCollectionRef = collection(db, `artifacts/${appId}/public/data/messages`);
                        const q = query(messagesCollectionRef,
                            where("senderName", "==", viewerName),
                            where("password", "==", viewerPassword)
                        );

                        const querySnapshot = await getDocs(q);
                        let foundMessages = 0;

                        if (querySnapshot.empty) {
                            showStatusMessage(viewStatusMessage, "‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ü‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ/‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", true);
                        } else {
                            for (const docSnapshot of querySnapshot.docs) {
                                const messageData = docSnapshot.data();
                                const messageMode = messageData.mode || 'one-time';
                                const oneHour = 3600000;

                                const docRef = doc(db, `artifacts/${appId}/public/data/messages`, docSnapshot.id);

                                if (messageMode === 'one-time') {
                                    foundMessages++;
                                    const messageDiv = document.createElement('div');
                                    messageDiv.textContent = messageData.message;
                                    messageDiv.className = 'message-item';
                                    viewedMessagesContainer.appendChild(messageDiv);

                                    await deleteDoc(docRef);
                                } else if (messageMode === 'timed') {
                                    if (messageData.deletionTimestamp && Date.now() > messageData.deletionTimestamp) {
                                        await deleteDoc(docRef);
                                        continue;
                                    } else {
                                        foundMessages++;
                                        const messageDiv = document.createElement('div');
                                        messageDiv.textContent = messageData.message;
                                        messageDiv.className = 'message-item';
                                        viewedMessagesContainer.appendChild(messageDiv);

                                        if (!messageData.deletionTimestamp) {
                                            await updateDoc(docRef, {
                                                deletionTimestamp: Date.now() + oneHour
                                            });
                                        }
                                    }
                                }
                            }

                            if (foundMessages > 0) {
                                messageDisplay.style.display = 'block';
                                showStatusMessage(viewStatusMessage, "‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá!", false);
                            } else {
                                showStatusMessage(viewStatusMessage, "‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", true);
                            }
                        }
                    } catch (error) {
                        console.error("Error viewing message:", error);
                        showStatusMessage(viewStatusMessage, `‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${error.message}`, true);
                    } finally {
                        viewBtn.disabled = false;
                    }
                });
            }

            function showForm(formId) {
                sendMessageForm.classList.add('hidden');
                viewMessageForm.classList.add('hidden');
                document.getElementById(formId).classList.remove('hidden');
                sendStatusMessage.style.display = 'none';
                viewStatusMessage.style.display = 'none';
                messageDisplay.style.display = 'none';
            }
        </script>
</body>

</html>